<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JVS Tuki – Kysely + Sähköpostiin lähetys</title>
  <link rel="icon" href="logo.png" />
  <style>
    :root { --bg:#0b1020; --card:#121a33; --muted:#8ea0c9; --text:#eef2ff; --accent:#5dd6ff; }
    * { box-sizing:border-box; }
    body { margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:linear-gradient(180deg,#0b1020,#0e1530); color:var(--text); }
    a { color:var(--accent); }
    header, footer { max-width:1100px; margin:0 auto; padding:24px 20px; }
    .brand { display:flex; align-items:center; gap:10px; font-weight:800; }
    .brand img { width:36px; height:36px; border-radius:8px; }
    .section { max-width:1100px; margin:8px auto; padding:0 20px 32px; }
    .card { background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.08); border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,.35); }
    .panel { padding:22px; }
    h1 { margin:0; font-size: clamp(26px, 3vw, 38px); }
    .video { width:100%; aspect-ratio:16/9; border:0; border-radius:16px; background:#000; }
    form { display:grid; gap:16px; }
    fieldset { border:1px solid rgba(255,255,255,.1); border-radius:16px; padding:14px; }
    legend { padding:0 6px; font-weight:800; color:#dfe7ff; }
    label { display:block; margin:8px 0; }
    input[type=text], input[type=email], textarea, select { width:100%; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.15); background:rgba(255,255,255,.04); color:var(--text); }
    textarea { min-height:90px; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; }
    .btn { padding:12px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.15); background:transparent; color:var(--text); cursor:pointer; font-weight:800; }
    .btn-primary { background:linear-gradient(135deg, var(--accent), #7fe4ff); color:#0a0f1f; border:none; }
    .note { color:var(--muted); font-size:14px; }
    .ok { color:#c6ffd4; font-weight:700; }
    .err { color:#ffb3b3; font-weight:700; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="logo.png" alt="logo" />
      <div>JVS Tuki</div>
    </div>
  </header>

  <section class="section card panel">
    <h2>Esittelyvideot</h2>
    <div style="display:grid; gap:16px;">
      <video class="video" controls playsinline poster="logo.png">
        <source src="video.mp4" type="video/mp4" />
        Selaimesi ei tue videon toistoa.
      </video>
      <iframe class="video" src="https://www.youtube.com/embed/O5XZAcHE_fI" title="YouTube video"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    </div>
  </section>

  <section id="kysely" class="section card panel">
    <h2>Asiakaskysely</h2>
    <p class="note">Kun painat <strong>Lähetä / Tallenna</strong>, vastaukset: (1) latautuvat CSV-tiedostona ja (2) lähetetään sähköpostitse Formspree-palvelun kautta osoitteeseesi (kun lisäät oman lomakkeen tunnuksen).</p>

    <!-- IMPORTANT: replace YOUR_FORM_ID below after creating a Formspree form -->
    <form id="surveyForm" method="POST" action="https://formspree.io/f/mzzaaqyj">
      <input type="hidden" name="_subject" value="Asiakaskyselyn vastaus – JVS Tuki" />
      <!-- This hidden field will be filled with formatted summary before submit -->
      <input type="hidden" name="message" id="messageField" />

      <fieldset>
        <legend>1. Kokemus valinnan vaikeudesta</legend>
        <label><input type="radio" name="valinnan_vaikeus" value="Kyllä" required> Kyllä</label>
        <label><input type="radio" name="valinnan_vaikeus" value="Ei"> Ei</label>
      </fieldset>

      <fieldset>
        <legend>2. Kiinnostus palveluun</legend>
        <label><input type="radio" name="kiinnostus" value="Kyllä, varmasti" required> Kyllä, varmasti</label>
        <label><input type="radio" name="kiinnostus" value="Ehkä, jos hinta on sopiva"> Ehkä, jos hinta on sopiva</label>
        <label><input type="radio" name="kiinnostus" value="Ei kiinnosta"> Ei kiinnosta</label>
      </fieldset>

      <fieldset>
        <legend>3. Tärkeimmät asiat</legend>
        <label><input type="checkbox" name="tarkeaa" value="Hinta"> Hinta</label>
        <label><input type="checkbox" name="tarkeaa" value="Nopeus"> Nopeus</label>
        <label><input type="checkbox" name="tarkeaa" value="Luotettavuus"> Luotettavuus</label>
        <label><input type="checkbox" name="tarkeaa" value="Helppous"> Helppous</label>
        <label>Muu: <input type="text" name="muu_tarkeaa" placeholder="Kerro mikä"></label>
      </fieldset>

      <fieldset>
        <legend>4. Miten haluaisit saada apua?</legend>
        <label><input type="checkbox" name="muoto" value="Puhelin"> Puhelin</label>
        <label><input type="checkbox" name="muoto" value="Videopuhelu"> Videopuhelu</label>
        <label><input type="checkbox" name="muoto" value="Paikan päällä"> Kotona paikan päällä</label>
        <label><input type="checkbox" name="muoto" value="Chat / viesti"> Chat / viesti</label>
      </fieldset>

      <fieldset>
        <legend>5. Mielipide esittelystä</legend>
        <label>Houkutteleva?
          <select name="houkutteleva" required>
            <option value="">Valitse</option>
            <option>Kyllä</option>
            <option>Jotenkin</option>
            <option>Ei</option>
          </select>
        </label>
        <label>Ymmärrettävä?
          <select name="ymmarrettava" required>
            <option value="">Valitse</option>
            <option>Kyllä</option>
            <option>Osittain</option>
            <option>Ei</option>
          </select>
        </label>
        <label>Mitä pitäisi parantaa?
          <textarea name="parannus" placeholder="Vapaa sana"></textarea>
        </label>
      </fieldset>

      <fieldset class="row two">
        <legend>6. Yhteystiedot (vapaaehtoinen)</legend>
        <label>Nimi <input type="text" name="nimi" placeholder="Etunimi Sukunimi"/></label>
        <label>Sähköposti (jos haluat vastauksen kopion) <input type="email" name="email" placeholder="esimerkki@domain.fi"/></label>
      </fieldset>

      <fieldset>
        <legend>7. Vapaa sana</legend>
        <textarea name="kommentti" placeholder="Kirjoita kommentti"></textarea>
      </fieldset>

      <div class="actions">
        <button type="submit" class="btn btn-primary">Lähetä / Tallenna</button>
        <button type="button" id="downloadCsv" class="btn">Lataa CSV</button>
        <button type="button" id="copyJson" class="btn">Kopioi JSON</button>
      </div>
      <p id="status" class="note"></p>
      <p class="note">Tietosuoja: Vastaukset lähetetään sähköpostitse Formspree-palvelun kautta ja niitä käytetään palvelun kehittämiseen.</p>
    </form>
  </section>

  <footer>
    © <span id="year"></span> JVS Tuki • Espoo – Helsinki • Yksinyrittäjä • <a href="mailto:jvstuki@outlook.com">jvstuki@outlook.com</a>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function formToObject(form) {
      const data = {}, formData = new FormData(form), multi = {};
      for (const [key, value] of formData.entries()) {
        const isMulti = form.querySelectorAll(`[name="${key}"][type="checkbox"]`).length > 0;
        if (isMulti) (multi[key] ||= []).push(value);
        else data[key] = value;
      }
      for (const k in multi) data[k] = multi[k];
      return data;
    }

    function toCsv(obj) {
      const headers = Object.keys(obj);
      const values = headers.map(k => Array.isArray(obj[k]) ? '"' + obj[k].join('; ') + '"' : '"' + String(obj[k] ?? '').replaceAll('"','\\"') + '"');
      return headers.join(',') + '\n' + values.join(',');
    }

    function download(filename, content, type = 'text/plain') {
      const blob = new Blob([content], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }

    const form = document.getElementById('surveyForm');
    const status = document.getElementById('status');
    const messageField = document.getElementById('messageField');

    function formatEmail(obj) {
      const lines = [
        'Asiakaskyselyn vastaus – JVS Tuki',
        '---------------------------------',
        `1. Valinnan vaikeus: ${obj.valinnan_vaikeus || ''}`,
        `2. Kiinnostus: ${obj.kiinnostus || ''}`,
        `3. Tärkeintä: ${Array.isArray(obj.tarkeaa)? obj.tarkeaa.join('; ') : (obj.tarkeaa || '')}`,
        `   Muu: ${obj.muu_tarkeaa || ''}`,
        `4. Muoto: ${Array.isArray(obj.muoto)? obj.muoto.join('; ') : (obj.muoto || '')}`,
        `5. Houkutteleva: ${obj.houkutteleva || ''}`,
        `   Ymmärrettävä: ${obj.ymmarrettava || ''}`,
        `   Parannus: ${obj.parannus || ''}`,
        `6. Nimi: ${obj.nimi || ''}`,
        `   Sähköposti: ${obj.email || ''}`,
        `7. Kommentti: ${obj.kommentti || ''}`
      ];
      return lines.join('\n');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const obj = formToObject(form);

      // 1) всегда сохраняем локально CSV
      const csv = toCsv(obj);
      const ts = new Date().toISOString().replace(/[:.]/g,'-');
      download(`jvs-kysely-${ts}.csv`, csv, 'text/csv');

      // 2) отправляем email через Formspree
      const formIdPlaceholder = 'YOUR_FORM_ID';
      if (form.action.includes(formIdPlaceholder)) {
        status.textContent = '⚠️ Sähköpostilähetys ei ole vielä käytössä. Luo Formspree-lomake ja korvaa YOUR_FORM_ID omallasi.';
        status.className = 'note err';
        return;
      }

      messageField.value = formatEmail(obj);

      try {
        const resp = await fetch(form.action, {
          method: 'POST',
          headers: { 'Accept': 'application/json' },
          body: new FormData(form)
        });
        if (resp.ok) {
          status.textContent = '✅ Vastaukset lähetetty sähköpostiin.';
          status.className = 'note ok';
          form.reset();
        } else {
          status.textContent = '⚠️ Lähetys epäonnistui. Tarkista Formspree-asetukset.';
          status.className = 'note err';
        }
      } catch (err) {
        status.textContent = '⚠️ Lähetysvirhe (verkkoyhteys tms.).';
        status.className = 'note err';
      }
    });

    document.getElementById('downloadCsv').addEventListener('click', () => {
      const obj = formToObject(form);
      const csv = toCsv(obj);
      const ts = new Date().toISOString().replace(/[:.]/g,'-');
      download(`jvs-kysely-${ts}.csv`, csv, 'text/csv');
      status.textContent = 'CSV ladattu.';
      status.className = 'note ok';
    });

    document.getElementById('copyJson').addEventListener('click', async () => {
      const obj = formToObject(form);
      const json = JSON.stringify(obj, null, 2);
      try { await navigator.clipboard.writeText(json); status.textContent = 'JSON kopioitu.'; status.className = 'note ok'; }
      catch { status.textContent = 'Kopiointi ei onnistunut.'; status.className = 'note err'; }
    });
  </script>
</body>
</html>
